# 镜像

### 获取镜像

```
docker pull [选项] [Docker Registry地址]<仓库名>:<标签>
# 例如,没写Registry地址就从官方下载
docker pull ubuntu:14.04
```

* Docker Registry地址 : 地址的格式一般是`<域名/IP>[:端口号]`.默认地址是 Docker Hub

* 仓库名 : 如之前所说,这里的仓库名是两段式名称,既`<用户名>/<软件名>`.对于Docker Hub,如果不给出用户名,则默认为`library`,也就是官方镜像

下载过程可以看出前面提及的分层存储概念,镜像是由多层存储所构成的.下载过程中给出了每一层的ID前12位.下载结束后给出完整的sha256摘要.

### 运行

运行上面pull的镜像ubuntu:14.04,然后启动里面的bash并且进行交互操作.

```
docker run -it --rm ubuntu:14.04 bash
```

参数详解

* -it : 这里是两个参数,一个是`-i`交互操作,一个是`-t`终端.放在一起的意思是交互式终端
* --rm : 这个参数是说容器退出后随之将其删除.一般情况是不会删除的,一般会手动使用`docker rm`删除.我们现在只是随便测试一下.
* ubuntu:14.04 : 意思是指用ubuntu:14.04镜像为基础来启动容器.
* bash : 放在镜像名后的是命令,bash就是一个交互式shell

查看一下当前系统版本

```
cat /etc/os-release
```

可以看到`Ubuntu 14.04.5 LTS`

最后可以通过`exit`退出

### 列出镜像

列出已经下载的镜像

```
docker images
```

列表包含了仓库名,标签,镜像ID,创建时间,占用空间.

##### 镜像体积

Docker Hub上显示的是镜像压缩后的体积.使用命令docker images列表中的镜像体积也并非硬盘实际消耗的体积,因为Docker镜像是多层存储的,里面有很多继承,复用的关系.所以比实际的要小很多.

##### 虚悬镜像

镜像列表中即没有仓库名,也没有标签名的镜像,是镜像发布了新版本后,重新pull后,新旧镜像同名,旧镜像名称被取消产生的&lt;none&gt;镜像.这种无标签的镜像就是虚悬镜像\(dangling image\).

> docker pull 和 docker build都会导致新旧镜像替换产生的虚悬镜像

```
# 查看虚悬镜像列表
docker images -f dangling=true
```

一般情况下,虚悬镜像已经失去了存在的价值,可以随意删除

```
docker rmi (docker images -q -f dangling=true)
```

##### 中间层镜像

为了加速惊现构建和重复利用资源,Docker会利用中间层镜像作为依赖镜像.使用参数`-a`列出包括所有镜像包括中间层

```
docker images -a
```

这时会列出很多无标签镜像,但有别于虚悬镜像,删除会因为依赖丢失而出错.中间层镜像会随依赖删除而删除.

##### 列出部分镜像

根据仓库名列出镜像

```
docker images ubuntu
```

列出特定的某个镜像\(指定仓库名和标签\)

```
docker images ubuntu:16.04
```

使用过滤器参数`-f(--filter)`过滤镜像

```
# 在mongo:3.2之后建立的镜像
docker images -f since=mongo:3.2
# 查看某个位置之前的镜像
docker images -f before=mongo:3.2
# 还可以通过label过滤镜像列表
docker images -f label=com.example.version=0.1
```



